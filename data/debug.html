<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESP32 Debugging Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #121212;
            color: #e0e0e0;
        }
        .card {
            background-color: #1e1e1e;
            border: 1px solid #333;
            color: #e0e0e0;
        }
        .card-header {
            background-color: #292929;
            border-bottom: 1px solid #444;
            color: #ffffff;
            font-weight: bold;
        }
        .card-body p {
            margin-bottom: 0.5rem;
        }
        h1 {
            color: #ffffff;
        }
        a {
            color: #bb86fc;
        }
        a:hover {
            color: #ffffff;
        }
        .text-danger {
            color: #ff4d4d; /* Color rojo brillante */
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center my-4">ESP32 Debugging Dashboard</h1>
        
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-1 g-4">
            <!-- Radio Section -->
            <div class="col">
                <div class="card">
                    <div class="card-header">Radio</div>
                    <div class="card-body">
                        <div class="row">
                            <!-- Primera columna -->
                            <div class="col-6">
                                <h6 class="card-title">RF Analog Module:</h6>
                                <p>Enable: <span id="rfEnable"></span></p>
                                <p>Module Type: <span id="rfModuleType"></span></p>
                                <p>TX Frequency: <span id="txFrequency"></span></p>
                                <p>RX Frequency: <span id="rxFrequency"></span></p>
                                <p>TX Power: <span id="txPower"></span></p>
                                <p>Volume: <span id="volume"></span></p>
                                <p>SQL Level: <span id="sqlLevel"></span></p>
                            </div>
                            <!-- Segunda columna -->
                            <div class="col-6">
                                <h6 class="mt-3">AFSK/TNC Configuration:</h6>
                                <p>Modem Type: <span id="modemType"></span></p>
                                <p>Audio HPF: <span id="audioHpf"></span></p>
                                <p>Audio BPF: <span id="audioBpf"></span></p>
                                <p>TX Time Slot: <span id="txTimeSlot"></span></p>
                                <p>Preamble: <span id="preamble"></span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row g-2">
                <!-- IGate Section -->
                <div class="col">
                    <div class="card">
                        <div class="card-header">IGate</div>
                        <div class="card-body">
                            <p>Enable: <span id="igateEnable"></span></p>
                            <p>RF to Internet: <span id="rf2inet"></span></p>
                            <p>Internet to RF: <span id="inet2rf"></span></p>
                            <p>Station Callsign: <span id="igateCallsign"></span></p>
                            <p>Station SSID: <span id="igateSsid"></span></p>
                            <p>Path: <span id="igatePath"></span></p>
                            <p>Host: <span id="aprsHost"></span></p>
                            <p>Port: <span id="aprsPort"></span></p>
                            <p>Passcode: <span id="aprsPasscode"></span></p>
                            <p>Symbol: <span id="igateSymbol"></span></p>
                            <p>Latitude: <span id="igateLatitude"></span></p>
                            <p>Longitude: <span id="igateLongitude"></span></p>
                            <p>Altitude: <span id="igateAltitude"></span></p>
                            <p>Interval: <span id="igateInterval"></span></p>
                            <p>Comment: <span id="igateComment"></span></p>
                        </div>
                    </div>
                </div>

                <!-- Digipeater Section -->
                <div class="col">
                    <div class="card">
                        <div class="card-header">Digipeater (Digi)</div>
                        <div class="card-body">
                            <p>Enable: <span id="digiEnable"></span></p>
                            <p>Location to RF: <span id="digiLoc2Rf"></span></p>
                            <p>Location to Internet: <span id="digiLoc2Inet"></span></p>
                            <p>Filter: <span id="digiFilter"></span></p>
                            <p>Station Callsign: <span id="digiCallsign"></span></p>
                            <p>Station SSID: <span id="digiSsid"></span></p>
                            <p>Path: <span id="digiPath"></span></p>
                            <p>Latitude: <span id="digiLatitude"></span></p>
                            <p>Longitude: <span id="digiLongitude"></span></p>
                            <p>Altitude: <span id="digiAltitude"></span></p>
                            <p>Interval: <span id="digiInterval"></span></p>
                            <p>Timestamp: <span id="digiTimestamp"></span></p>
                            <p>Delay: <span id="digiDelay"></span></p>
                            <p>Symbol: <span id="digiSymbol"></span></p>
                            <p>Comment: <span id="digiComment"></span></p>
                        </div>
                    </div>
                </div>               

                <!-- Tracker Section -->
                <div class="col">
                    <div class="card">
                        <div class="card-header">Tracker</div>
                        <div class="card-body">
                            <p>Enable: <span id="trackerEnable"></span></p>
                            <p>Location to RF: <span id="trackerLoc2Rf"></span></p>
                            <p>Location to Internet: <span id="trackerLoc2Inet"></span></p>
                            <p>Smart Beacon: <span id="trackerSmartBeacon"></span></p>
                            <p>Compressed: <span id="trackerCompressed"></span></p>
                            <p>Altitude Included: <span id="trackerAltitudeIncluded"></span></p>
                            <p>Timestamp: <span id="trackerTimestamp"></span></p>
                            <p>High Speed: <span id="trackerHighSpeed"></span></p>
                            <p>Low Speed: <span id="trackerLowSpeed"></span></p>
                            <p>Min Interval: <span id="trackerMinInterval"></span></p>
                            <p>Max Interval: <span id="trackerMaxInterval"></span></p>
                            <p>Min Angle: <span id="trackerMinAngle"></span></p>
                            <p>Slow Interval: <span id="trackerSlowInterval"></span></p>
                            <p>Station Callsign: <span id="trackerCallsign"></span></p>
                            <p>Station SSID: <span id="trackerSsid"></span></p>
                            <p>Path: <span id="trackerPath"></span></p>
                            <p>Latitude: <span id="trackerLatitude"></span></p>
                            <p>Longitude: <span id="trackerLongitude"></span></p>
                            <p>Altitude: <span id="trackerAltitude"></span></p>
                            <p>Interval: <span id="trackerInterval"></span></p>
                            <p>Symbol: <span id="trackerSymbol"></span></p>
                            <p>Moving Symbol: <span id="trackerMovingSymbol"></span></p>
                            <p>Stopped Symbol: <span id="trackerStoppedSymbol"></span></p>
                            <p>Comment: <span id="trackerComment"></span></p>
                        </div>
                    </div>
                </div>               

                <!-- WX Section -->
                <div class="col">
                    <div class="card">
                        <div class="card-header">Weather Station (WX)</div>
                        <div class="card-body">
                            <p>Enable: <span id="wxEnable"></span></p>
                            <p>Location to RF: <span id="wxLoc2Rf"></span></p>
                            <p>Location to Internet: <span id="wxLoc2Inet"></span></p>
                            <p>Station Callsign: <span id="wxCallsign"></span></p>
                            <p>Station SSID: <span id="wxSsid"></span></p>
                            <p>Path: <span id="wxPath"></span></p>
                            <p>Latitude: <span id="wxLatitude"></span></p>
                            <p>Longitude: <span id="wxLongitude"></span></p>
                            <p>Altitude: <span id="wxAltitude"></span></p>
                            <p>Interval: <span id="wxInterval"></span></p>
                            <p>Comment: <span id="wxComment"></span></p>
                        </div>
                    </div>
                </div>               

                <!-- TLM Section -->
                <div class="col">
                    <div class="card">
                        <div class="card-header">Telemetry (TLM)</div>
                        <div class="card-body">
                            <p>Enable: <span id="tlmEnable"></span></p>
                            <p>Location to RF: <span id="tlmLoc2Rf"></span></p>
                            <p>Location to Internet: <span id="tlmLoc2Inet"></span></p>
                            <p>Station Callsign: <span id="tlmCallsign"></span></p>
                            <p>Station SSID: <span id="tlmSsid"></span></p>
                            <p>Path: <span id="tlmPath"></span></p>
                            <p>Data Interval: <span id="tlmDataInterval"></span></p>
                            <p>Info Interval: <span id="tlmInfoInterval"></span></p>
                            <p>Active Bits: <span id="tlmActiveBits"></span></p>
                            <p>Comment: <span id="tlmComment"></span></p>
                        </div>
                    </div>
                </div>                
            </div>

        <!-- Agrupación de Wireless, System Settings y Display Settings -->
        <div class="row g-2">
            <!-- Wireless Section -->
            <div class="col-12 col-sm-6 col-lg-4">
                <div class="card">
                    <div class="card-header">Wireless</div>
                    <div class="card-body">
                        <h6>WiFi Access Point Configuration:</h6>
                        <p>Enable: <span id="wifiApEnable"></span></p>
                        <p>WiFi AP SSID: <span id="wifiApSsid"></span></p>
                        <h6 class="mt-3">WiFi Multi Station Configuration:</h6>
                        <p>Station #1 Enable: <span id="wifiSta1Enable"></span></p>
                        <p>WiFi AP SSID: <span id="wifiSta1Ssid"></span></p>
                    </div>
                </div>
            </div>

            <!-- System Settings Section -->
            <div class="col-12 col-sm-6 col-lg-4">
                <div class="card">
                    <div class="card-header">System Setting</div>
                    <div class="card-body">
                        <p>Local Date/Time: <span id="localDateTime"></span></p>
                        <p>NTP Host: <span id="ntpHost"></span></p>
                        <p>Time Zone: <span id="timeZone"></span></p>
                        <p>Web USER: <span id="webUser"></span></p>
                        <p>Web PASSWORD: <span id="webPassword"></span></p>
                        <h6 class="mt-3">Paths:</h6>
                        <p>PATH_1: <span id="path1"></span></p>
                        <p>PATH_2: <span id="path2"></span></p>
                        <p>PATH_3: <span id="path3"></span></p>
                        <p>PATH_4: <span id="path4"></span></p>
                    </div>
                </div>
            </div>

            <!-- Sección MOD -->
            <div class="col">
                <div class="card">
                    <div class="card-header">MOD Configuration</div>
                    <div class="card-body">
                        <h6>GNSS Configuration:</h6>
                        <p>Enable: <span id="gnssEnable"></span></p>
                        <p>Port: <span id="gnssPort"></span></p>
                        <p>AT Command: <span id="gnssAtCommand"></span></p>
                        <p>TCP Host: <span id="gnssTcpHost"></span></p>
                        <p>TCP Port: <span id="gnssTcpPort"></span></p>

                        <h6 class="mt-3">MODBUS Configuration:</h6>
                        <p>Enable: <span id="modbusEnable"></span></p>
                        <p>Channel: <span id="modbusChannel"></span></p>
                        <p>Address: <span id="modbusAddress"></span></p>
                        <p>DE GPIO: <span id="modbusDeGpio"></span></p>

                        <h6 class="mt-3">UART0 Configuration:</h6>
                        <p>Enable: <span id="uart0Enable"></span></p>
                        <p>Baudrate: <span id="uart0Baudrate"></span></p>
                        <p>RX GPIO: <span id="uart0RxGpio"></span></p>
                        <p>TX GPIO: <span id="uart0TxGpio"></span></p>
                        <p>RTS GPIO: <span id="uart0RtsGpio"></span></p>
                    </div>
                </div>
            </div>

            <!-- Sección RF GPIO Modify -->
            <div class="col">
                <div class="card">
                    <div class="card-header">MOD: RF GPIO Modify</div>
                    <div class="card-body">
                        <p>RX GPIO: <span id="rfRxGpio"></span></p>
                        <p>TX GPIO: <span id="rfTxGpio"></span></p>
                        <p>PD GPIO: <span id="rfPdGpio"></span></p>
                        <p>PTT GPIO: <span id="rfPttGpio"></span></p>
                        <p>Baudrate: <span id="rfBaudrate"></span></p>
                        <p>ADC Attenuation: <span id="adcAtten"></span></p>
                        <p>ADC DC Offset: <span id="adcDcOffset"></span></p>
                    </div>
                </div>
            </div>            

            <!-- Display Setting Section -->
            <div class="col-12 col-sm-6 col-lg-4">
                <div class="card">
                    <div class="card-header">Display Setting</div>
                    <div class="card-body">
                        <p>OLED Enable: <span id="oledEnable"></span></p>
                        <p>TX Display: <span id="txDisplay"></span></p>
                        <p>RX Display: <span id="rxDisplay"></span></p>
                        <p>Head Up: <span id="headUp"></span></p>
                        <p>Popup Delay: <span id="popupDelay"></span></p>
                        <p>RX Channel - RF: <span id="rxChannelRF"></span></p>
                        <p>RX Channel - Internet: <span id="rxChannelINET"></span></p>
                        <p>Filter DX: <span id="filterDx"></span></p>
                        <p>Filters: <span id="filters"></span></p>
                    </div>
                </div>
            </div>
        </div>

        </div>
    </div>

    <script>
        function setTextOrFallback(elementId, value) {
            const element = document.getElementById(elementId);
            if (value === undefined || value === null) {
                element.innerText = "No data";
                element.classList.add("text-danger"); // Clase para texto rojo
            } else {
                element.innerText = value;
                element.classList.remove("text-danger"); // Remueve el estilo si ya tiene datos
            }
        }

        async function fetchDebugData() {
            try {
                const response = await fetch('/debug-info');
                if (!response.ok) throw new Error('Error en la consulta');
                
                const data = await response.json();

            // Actualizar los valores para Radio
            setTextOrFallback("rfEnable", data.radio.rfEnable);
            setTextOrFallback("rfModuleType", data.radio.rfModuleType);
            setTextOrFallback("txFrequency", data.radio.txFrequency);
            setTextOrFallback("rxFrequency", data.radio.rxFrequency);
            setTextOrFallback("txPower", data.radio.txPower);
            setTextOrFallback("volume", data.radio.volume);
            setTextOrFallback("sqlLevel", data.radio.sqlLevel);
            setTextOrFallback("modemType", data.radio.modemType);
            setTextOrFallback("audioHpf", data.radio.audioHpf);
            setTextOrFallback("audioBpf", data.radio.audioBpf);
            setTextOrFallback("txTimeSlot", data.radio.txTimeSlot);
            setTextOrFallback("preamble", data.radio.preamble);

            // Actualizar los valores para IGate
            setTextOrFallback("igateEnable", data.igate.enable);
            setTextOrFallback("rf2inet", data.igate.rf2inet);
            setTextOrFallback("inet2rf", data.igate.inet2rf);
            setTextOrFallback("igateCallsign", data.igate.stationCallsign);
            setTextOrFallback("igateSsid", data.igate.stationSsid);
            setTextOrFallback("igatePath", data.igate.path);
            setTextOrFallback("aprsHost", data.igate.host);
            setTextOrFallback("aprsPort", data.igate.port);
            setTextOrFallback("aprsPasscode", data.igate.passcode);
            setTextOrFallback("igateSymbol", data.igate.symbol);
            setTextOrFallback("igateLatitude", data.igate.latitude);
            setTextOrFallback("igateLongitude", data.igate.longitude);
            setTextOrFallback("igateAltitude", data.igate.altitude);
            setTextOrFallback("igateInterval", data.igate.interval);
            setTextOrFallback("igateComment", data.igate.comment);

            // Actualizar los valores para Digi
            setTextOrFallback("digiEnable", data.digi.enable);
            setTextOrFallback("digiLoc2Rf", data.digi.locationToRf);
            setTextOrFallback("digiLoc2Inet", data.digi.locationToInet);
            setTextOrFallback("digiFilter", data.digi.filter);
            setTextOrFallback("digiCallsign", data.digi.stationCallsign);
            setTextOrFallback("digiSsid", data.digi.stationSsid);
            setTextOrFallback("digiPath", data.digi.path);
            setTextOrFallback("digiLatitude", data.digi.latitude);
            setTextOrFallback("digiLongitude", data.digi.longitude);
            setTextOrFallback("digiAltitude", data.digi.altitude);
            setTextOrFallback("digiInterval", data.digi.interval);
            setTextOrFallback("digiTimestamp", data.digi.timestamp);
            setTextOrFallback("digiDelay", data.digi.delay);
            setTextOrFallback("digiSymbol", data.digi.symbol);
            setTextOrFallback("digiComment", data.digi.comment);

            // Actualizar los valores para Tracker
            setTextOrFallback("trackerEnable", data.tracker.enable);
            setTextOrFallback("trackerLoc2Rf", data.tracker.locationToRf);
            setTextOrFallback("trackerLoc2Inet", data.tracker.locationToInet);
            setTextOrFallback("trackerSmartBeacon", data.tracker.smartBeacon);
            setTextOrFallback("trackerCompressed", data.tracker.compressed);
            setTextOrFallback("trackerAltitudeIncluded", data.tracker.altitudeIncluded);
            setTextOrFallback("trackerTimestamp", data.tracker.timestamp);
            setTextOrFallback("trackerHighSpeed", data.tracker.highSpeed);
            setTextOrFallback("trackerLowSpeed", data.tracker.lowSpeed);
            setTextOrFallback("trackerMinInterval", data.tracker.minInterval);
            setTextOrFallback("trackerMaxInterval", data.tracker.maxInterval);
            setTextOrFallback("trackerMinAngle", data.tracker.minAngle);
            setTextOrFallback("trackerSlowInterval", data.tracker.slowInterval);
            setTextOrFallback("trackerCallsign", data.tracker.stationCallsign);
            setTextOrFallback("trackerSsid", data.tracker.stationSsid);
            setTextOrFallback("trackerPath", data.tracker.path);
            setTextOrFallback("trackerLatitude", data.tracker.latitude);
            setTextOrFallback("trackerLongitude", data.tracker.longitude);
            setTextOrFallback("trackerAltitude", data.tracker.altitude);
            setTextOrFallback("trackerInterval", data.tracker.interval);
            setTextOrFallback("trackerSymbol", data.tracker.symbol);
            setTextOrFallback("trackerMovingSymbol", data.tracker.movingSymbol);
            setTextOrFallback("trackerStoppedSymbol", data.tracker.stoppedSymbol);
            setTextOrFallback("trackerComment", data.tracker.comment);

            // Actualizar los valores para WX
            setTextOrFallback("wxEnable", data.wx.enable);
            setTextOrFallback("wxLoc2Rf", data.wx.locationToRf);
            setTextOrFallback("wxLoc2Inet", data.wx.locationToInet);
            setTextOrFallback("wxCallsign", data.wx.stationCallsign);
            setTextOrFallback("wxSsid", data.wx.stationSsid);
            setTextOrFallback("wxPath", data.wx.path);
            setTextOrFallback("wxLatitude", data.wx.latitude);
            setTextOrFallback("wxLongitude", data.wx.longitude);
            setTextOrFallback("wxAltitude", data.wx.altitude);
            setTextOrFallback("wxInterval", data.wx.interval);
            setTextOrFallback("wxComment", data.wx.comment);

            // Actualizar los valores para TLM
            setTextOrFallback("tlmEnable", data.tlm.enable);
            setTextOrFallback("tlmLoc2Rf", data.tlm.locationToRf);
            setTextOrFallback("tlmLoc2Inet", data.tlm.locationToInet);
            setTextOrFallback("tlmCallsign", data.tlm.stationCallsign);
            setTextOrFallback("tlmSsid", data.tlm.stationSsid);
            setTextOrFallback("tlmPath", data.tlm.path);
            setTextOrFallback("tlmDataInterval", data.tlm.dataInterval);
            setTextOrFallback("tlmInfoInterval", data.tlm.infoInterval);
            setTextOrFallback("tlmActiveBits", data.tlm.activeBits);
            setTextOrFallback("tlmComment", data.tlm.comment);

            // Actualizar los valores para Wireless
            setTextOrFallback("wifiApEnable", data.wireless?.wifiApEnable);
            setTextOrFallback("wifiApSsid", data.wireless?.wifiApSsid);
            setTextOrFallback("wifiSta1Enable", data.wireless?.wifiSta1Enable);
            setTextOrFallback("wifiSta1Ssid", data.wireless?.wifiSta1Ssid);

            // Actualizar los valores para MOD
            setTextOrFallback("gnssEnable", data.mod?.gnssEnable);
            setTextOrFallback("gnssPort", data.mod?.gnssPort);
            setTextOrFallback("gnssAtCommand", data.mod?.gnssAtCommand);
            setTextOrFallback("gnssTcpHost", data.mod?.gnssTcpHost);
            setTextOrFallback("gnssTcpPort", data.mod?.gnssTcpPort);

            setTextOrFallback("modbusEnable", data.mod?.modbusEnable);
            setTextOrFallback("modbusChannel", data.mod?.modbusChannel);
            setTextOrFallback("modbusAddress", data.mod?.modbusAddress);
            setTextOrFallback("modbusDeGpio", data.mod?.modbusDeGpio);

            setTextOrFallback("uart0Enable", data.mod?.uart0Enable);
            setTextOrFallback("uart0Baudrate", data.mod?.uart0Baudrate);
            setTextOrFallback("uart0RxGpio", data.mod?.uart0RxGpio);
            setTextOrFallback("uart0TxGpio", data.mod?.uart0TxGpio);
            setTextOrFallback("uart0RtsGpio", data.mod?.uart0RtsGpio);            

            // RF GPIO Modify
            setTextOrFallback("rfRxGpio", data.mod?.rfRxGpio);
            setTextOrFallback("rfTxGpio", data.mod?.rfTxGpio);
            setTextOrFallback("rfPdGpio", data.mod?.rfPdGpio);
            setTextOrFallback("rfPttGpio", data.mod?.rfPttGpio);
            setTextOrFallback("rfBaudrate", data.mod?.rfBaudrate);
            setTextOrFallback("adcAtten", data.mod?.adcAtten);
            setTextOrFallback("adcDcOffset", data.mod?.adcDcOffset);            

            // Actualizar los valores para System
            setTextOrFallback("localDateTime", data.system.localDateTime);
            setTextOrFallback("ntpHost", data.system.ntpHost);
            setTextOrFallback("timeZone", data.system.timeZone);
            setTextOrFallback("webUser", data.system.webUser);
            setTextOrFallback("webPassword", data.system.webPassword);
            // System Paths
            setTextOrFallback("path1", data.system.paths.path1);
            setTextOrFallback("path2", data.system.paths.path2);
            setTextOrFallback("path3", data.system.paths.path3);
            setTextOrFallback("path4", data.system.paths.path4);

            // Actualizar los valores para Display Setting
            setTextOrFallback("oledEnable", data.display?.oledEnable);
            setTextOrFallback("txDisplay", data.display?.txDisplay);
            setTextOrFallback("rxDisplay", data.display?.rxDisplay);
            setTextOrFallback("headUp", data.display?.headUp);
            setTextOrFallback("popupDelay", data.display?.popupDelay);
            setTextOrFallback("rxChannelRF", data.display?.rxChannelRF);
            setTextOrFallback("rxChannelINET", data.display?.rxChannelINET)
            setTextOrFallback("filterDx", data.display?.filterDx);
            setTextOrFallback("filters", data.display?.filters);

            } catch (error) {
                console.error("Error al obtener los datos:", error);
            }
        }

        // Llama a la función al cargar la página
        document.addEventListener("DOMContentLoaded", fetchDebugData);

    </script>
</body>
</html>
