<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <title>ESP32IGATE - System</title>
</head>

<body class="bg-dark text-light">
    <div class="container py-3">
        <h1 class="text-center"><a href="/" class="text-decoration-none text-light">ESP32IGate Project [APRS ALL IN ONE]</a></h1>
    </div>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-center" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link" href="/">Dashboard</a></li>
                <li class="nav-item"><a class="nav-link" href="/radio">Radio</a></li>
                <li class="nav-item"><a class="nav-link" href="/tnc2">TNC</a></li>
                <li class="nav-item"><a class="nav-link" href="/gnss">GNSS</a></li>
                <!-- Submenú para Igate -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="igateDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        IGATE
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="igateDropdown">
                        <li><a class="dropdown-item" href="/igate/general">General</a></li>
                        <li><a class="dropdown-item" href="/igate/position">Position</a></li>
                        <li><a class="dropdown-item" href="/igate/phg">PHG</a></li>
                        <li><a class="dropdown-item" href="/igate/filter">Filter</a></li>
                    </ul>
                </li>                
                <!-- Submenú para Digi -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="digiDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Digi
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="digiDropdown">
                        <li><a class="dropdown-item" href="/digi/general">General</a></li>
                        <li><a class="dropdown-item" href="/digi/position">Position</a></li>
                        <li><a class="dropdown-item" href="/digi/phg">PHG</a></li>
                        <li><a class="dropdown-item" href="/digi/filter">Filter</a></li>
                    </ul>
                </li>          
                <!-- Submenú para Tracker -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="trackerDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Tracker
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="trackerDropdown">
                        <li><a class="dropdown-item" href="/tracker/general">General</a></li>
                        <li><a class="dropdown-item" href="/tracker/position">Position</a></li>
                        <li><a class="dropdown-item" href="/tracker/smartbeacon">Smart Beacon</a></li>
                    </ul>
                </li>     
                <!-- Submenú para WX -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle " href="#" id="wxDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        WX
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="wxDropdown">
                        <li><a class="dropdown-item" href="/wx/general">General</a></li>
                        <li><a class="dropdown-item" href="/wx/position">Position</a></li>
                        <li><a class="dropdown-item" href="/wx/smartbeacon">PHG</a></li>
                    </ul>
                </li>     
                <!-- Submenú para TLM -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle " href="#" id="tlmDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        TLM
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="tlmDropdown">
                        <li><a class="dropdown-item" href="/tlm/general">General</a></li>
                        <li><a class="dropdown-item" href="/tlm/channela">Channel A</a></li>
                        <li><a class="dropdown-item" href="/tlm/channelb">Channel B</a></li>
                    </ul>
                </li>     
                <li class="nav-item"><a class="nav-link" href="/wireless">Wireless</a></li>
                
                <!-- Submenú para Mod -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="modDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Mod
                    </a>
            <ul class="dropdown-menu" aria-labelledby="modDropdown">
                        <li><a class="dropdown-item" href="/mod/uart">UART</a></li>
                        <li><a class="dropdown-item" href="/mod/rf">RF GPIO</a></li>
                        <li><a class="dropdown-item" href="/mod/i2c">I2C</a></li>
                        <li><a class="dropdown-item" href="/mod/counter">Counters</a></li>
                        <li><a class="dropdown-item" href="/mod/gnss">GNSS</a></li>
                        <li><a class="dropdown-item" href="/mod/modbus">MODBUS</a></li>
                    </ul>
                </li>

                <li class="nav-item"><a class="nav-link active" href="/system">System</a></li>
                <li class="nav-item"><a class="nav-link" href="/about">About</a></li>
            </ul>
            </div>
        </div>
    </nav>
    <div class="container mt-4" id="contentmain">
        <h2 class="text-center mb-4">System Setting</h2>
        <table class="table table-dark table-striped">
            <tbody>
                <tr>
                    <th>LOCAL DATE/TIME</th>
                    <td>
                        <div class="d-flex align-items-center"><input type="text" class="form-control me-2" id="localDateTime" value="%localDateTime%"><button class="btn btn-primary" id="timeUpdate">Time Update</button></div>
                    </td>
                </tr>
                <tr>
                    <th>NTP Host</th>
                    <td>
                        <div class="d-flex align-items-center"><input type="text" class="form-control me-2" id="ntpHost" value="%ntpHost%"><button class="btn btn-primary" id="ntpUpdate">NTP Update</button></div>
                    </td>
                </tr>
                <tr>
                    <th>Time Zone</th>
                    <td>
                        <div class="d-flex align-items-center"><select class="form-select me-2" id="timeZone"><option value="-12" %timezoneselected-12%>GMT -12:00 International Date Line West</option><option value="-11" %timezoneselected-11%>GMT -11:00 Midway Island, Samoa</option><option value="-10" %timezoneselected-10%>GMT -10:00 Hawaii</option><option value="-9" %timezoneselected-9%>GMT -09:00 Alaska</option><option value="-8" %timezoneselected-8%>GMT -08:00 Pacific Time (US & Canada), Tijuana</option><option value="-7" %timezoneselected-7%>GMT -07:00 Mountain Time (US & Canada)</option><option value="-6" %timezoneselected-6%>GMT -06:00 Central Time (US & Canada), Mexico City</option><option value="-5" %timezoneselected-5%>GMT -05:00 Eastern Time (US & Canada), Bogota, Lima</option><option value="-4" %timezoneselected-4%>GMT -04:00 Atlantic Time (Canada), Caracas, La Paz</option><option value="-3" %timezoneselected-3%>GMT -03:00 Brasilia, Buenos Aires, Georgetown</option><option value="-2" %timezoneselected-2%>GMT -02:00 Mid-Atlantic</option><option value="-1" %timezoneselected-1%>GMT -01:00 Azores, Cape Verde Islands</option><option value="0" %timezoneselected0%>GMT 00:00 London, Lisbon, Casablanca</option><option value="1" %timezoneselected1%>GMT +01:00 Amsterdam, Berlin, Rome, Paris, Madrid</option><option value="2" %timezoneselected2%>GMT +02:00 Athens, Cairo, Jerusalem, Johannesburg</option><option value="3" %timezoneselected3%>GMT +03:00 Baghdad, Riyadh, Moscow, Nairobi</option><option value="4" %timezoneselected4%>GMT +04:00 Abu Dhabi, Baku, Muscat</option><option value="5" %timezoneselected5%>GMT +05:00 Islamabad, Karachi, Tashkent</option><option value="6" %timezoneselected6%>GMT +06:00 Almaty, Dhaka, Colombo</option><option value="7" %timezoneselected7%>GMT +07:00 Bangkok, Hanoi, Jakarta</option><option value="8" %timezoneselected8%>GMT +08:00 Beijing, Singapore, Hong Kong</option><option value="9" %timezoneselected9%>GMT +09:00 Tokyo, Seoul, Yakutsk</option><option value="10" %timezoneselected10%>GMT +10:00 Sydney, Guam, Vladivostok</option><option value="11" %timezoneselected11%>GMT +11:00 Magadan, Solomon Islands, New Caledonia</option><option value="12" %timezoneselected12%>GMT +12:00 Auckland, Wellington, Fiji</option></select>
                            <button
                                class="btn btn-primary" id="tzUpdate">TZ Update</button>
                        </div>
                    </td>
                </tr>
                <tr>
                    <th>SYSTEM REBOOT</th>
                    <td><button class="btn btn-danger w-100" id="systemReboot">REBOOT</button></td>
                </tr>
            </tbody>
        </table>
        <div class="text-center mt-3"><button class="btn btn-primary" id="applySystemChanges">Apply Changes</button></div>
        <h2 class="text-center mt-5 mb-4">Web Authentication</h2>
        <table class="table table-dark table-striped">
            <tbody>
                <tr>
                    <th>Web USER</th>
                    <td><input type="text" class="form-control" id="webUser" value="%webUser%"></td>
                </tr>
                <tr>
                    <th>Web PASSWORD</th>
                    <td><input type="password" class="form-control" id="webPassword" value="%webPassword%"></td>
                </tr>
            </tbody>
        </table>
        <div class="text-center mt-4 mb-5"><button class="btn btn-primary">Apply Changes</button></div>
        <h2 class="text-center mt-5 mb-4">PATH USER Define</h2>
        <table class="table table-dark table-striped">
            <tbody>
                <tr>
                    <th>PATH_1</th>
                    <td><input type="text" class="form-control" id="path1" value="%path1%"></td>
                </tr>
                <tr>
                    <th>PATH_2</th>
                    <td><input type="text" class="form-control" id="path2" value="%path2%"></td>
                </tr>
                <tr>
                    <th>PATH_3</th>
                    <td><input type="text" class="form-control" id="path3" value="%path3%"></td>
                </tr>
                <tr>
                    <th>PATH_4</th>
                    <td><input type="text" class="form-control" id="path4" value="%path4%"></td>
                </tr>
            </tbody>
        </table>
        <div class="text-center mt-3"><button class="btn btn-primary" id="applyPathChanges">Apply Changes</button></div>
        <div class="card text-bg-dark mb-4">
            <div class="card-header text-center bg-primary">
                <h2>Display Setting</h2>
            </div>
            <div class="card-body">
                <form action="/display" method="POST">
                    <table class="table table-dark table-striped">
                        <tbody>
                            <tr>
                                <th>OLED Enable</th>
                                <td>
                                    <div class="form-check form-switch"><input class="form-check-input" type="checkbox" id="oledEnable" name="oledEnable" %oledenable%></div>
                                </td>
                            </tr>
                            <tr>
                                <th>TX Display</th>
                                <td>
                                    <div class="form-check form-switch"><input class="form-check-input" type="checkbox" id="txDisplay" name="txDisplay" %txdisplay%></div>
                                </td>
                            </tr>
                            <tr>
                                <th>RX Display</th>
                                <td>
                                    <div class="form-check form-switch"><input class="form-check-input" type="checkbox" id="rxDisplay" name="rxDisplay" %rxdisplay%></div>
                                </td>
                            </tr>
                            <tr>
                                <th>Head Up</th>
                                <td>
                                    <div class="form-check form-switch"><input class="form-check-input" type="checkbox" id="headUp" name="headUp" %headup%></div>
                                </td>
                            </tr>
                            <tr>
                                <th>Popup Delay</th>
                                <td><select class="form-select" id="popupDelay" name="popupDelay"><option value="0" %popupdelay0%>0 Sec</option><option value="1" %popupdelay1%>1 Sec</option><option value="2" %popupdelay2%>2 Sec</option><option value="3" %popupdelay3%>3 Sec</option></select></td>
                            </tr>
                            <tr>
                                <th>RX Channel</th>
                                <td><input type="checkbox" id="rxChannelRF" name="rxChannelRF" %rxchannelrf%> RF <input type="checkbox" id="rxChannelINET" name="rxChannelINET" %rxchannelinet%> Internet</td>
                            </tr>
                            <tr>
                                <th>Filter DX</th>
                                <td><input type="number" class="form-control" id="filterDx" name="filterDx" value="%filterDx%"> Km</td>
                            </tr>
                            <tr>
                                <th>Filters</th>
                                <td><input type="checkbox" id="filterMessage" name="filterMessage" %filtermessage%> Message <input type="checkbox" id="filterStatus" name="filterStatus" %filterstatus%> Status <input type="checkbox" id="filterTelemetry" name="filterTelemetry"
                                        %filtertelemetry%> Telemetry <input type="checkbox" id="filterWeather" name="filterWeather" %filterweather%> Weather <input type="checkbox" id="filterObject" name="filterObject" %filterobject%> Object <input type="checkbox"
                                        id="filterItem" name="filterItem" %filteritem%> Item <input type="checkbox" id="filterQuery" name="filterQuery" %filterquery%> Query <input type="checkbox" id="filterBuoy" name="filterBuoy" %filterbuoy%> Buoy</td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="text-center mt-3"><button class="btn btn-primary" type="submit">Apply Changes</button></div>
                </form>
            </div>
        </div>
        <footer class="bg-primary text-center text-light py-3">ESP32IGate Web Configuration - &copy; 2025</footer>
        <script>
            // Actualizar fecha y hora local
            document.getElementById("timeUpdate").addEventListener("click", function() {
                const localDateTime = document.getElementById("localDateTime").value;
                if (!localDateTime) {
                    alert("Por favor, ingresa una fecha y hora válida.");
                    return;
                }
                fetch("/system", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/x-www-form-urlencoded"
                        },
                        body: `SetTime=${encodeURIComponent(localDateTime)}`
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error("Error en la solicitud: " + response.statusText);
                        }
                        return response.text();
                    })
                    .then(data => alert(data))
                    .catch(error => console.error("Error al actualizar la hora:", error));
            });

            // Actualizar NTP Host
            document.getElementById("ntpUpdate").addEventListener("click", function() {
                const ntpHost = document.getElementById("ntpHost").value;
                if (!ntpHost) {
                    alert("Por favor, ingresa un servidor NTP válido.");
                    return;
                }
                fetch("/system", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/x-www-form-urlencoded"
                        },
                        body: `SetTimeNtp=${encodeURIComponent(ntpHost)}`
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error("Error en la solicitud: " + response.statusText);
                        }
                        return response.text();
                    })
                    .then(data => alert(data))
                    .catch(error => console.error("Error al actualizar el NTP Host:", error));
            });

            // Actualizar zona horaria
            document.getElementById("tzUpdate").addEventListener("click", function() {
                const timeZone = document.getElementById("timeZone").value;
                fetch("/system", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/x-www-form-urlencoded"
                        },
                        body: `SetTimeZone=${encodeURIComponent(timeZone)}`
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error("Error en la solicitud: " + response.statusText);
                        }
                        return response.text();
                    })
                    .then(data => alert(data))
                    .catch(error => console.error("Error al actualizar la zona horaria:", error));
            });

            // Reiniciar el sistema
            document.getElementById("systemReboot").addEventListener("click", function() {
                if (confirm("¿Seguro que deseas reiniciar el sistema?")) {
                    fetch("/system", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/x-www-form-urlencoded"
                            },
                            body: "REBOOT=true"
                        })
                        .then(response => {
                            if (!response.ok) {
                                throw new Error("Error en la solicitud: " + response.statusText);
                            }
                            return response.text();
                        })
                        .then(data => alert(data))
                        .catch(error => console.error("Error al reiniciar el sistema:", error));
                }
            });
        </script>
</body>

</html>